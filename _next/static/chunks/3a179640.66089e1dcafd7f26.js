"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[170],{53077:function(e,n,a){a.d(n,{C:function(){return Be}});var l=a(2784),i=a(50117),t=a(65612),r=a(88410),o=a(21948),s=a(46364),u=a(49177),d=a(83112),c=a(48972),g=a(65060),v=a(94087),p=a(1136),m=a(52322),y=a(59508),k=a(55873),C=a(14823),f=a(11536),b=a(86421),h=a(62346),F=a(29904),S=a(63952);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function T(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,l)}return a}function K(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?T(Object(a),!0).forEach((function(n){_(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function _(e,n,a){return(n=function(e){var n=function(e,n){if("object"!==E(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,n||"default");if("object"!==E(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===E(n)?n:String(n)}(n))in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function L(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||x(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var l,i,t,r,o=[],s=!0,u=!1;try{if(t=(a=a.call(e)).next,0===n){if(Object(a)!==a)return;s=!1}else for(;!(s=(l=t.call(a)).done)&&(o.push(l.value),o.length!==n);s=!0);}catch(d){u=!0,i=d}finally{try{if(!s&&null!=a.return&&(r=a.return(),Object(r)!==r))return}finally{if(u)throw i}}return o}}(e,n)||x(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,n){if(e){if("string"===typeof e)return I(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,n):void 0}}function I(e,n){(null==n||n>e.length)&&(n=e.length);for(var a=0,l=new Array(n);a<n;a++)l[a]=e[a];return l}var N=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"conversationCount"}],n={alias:null,args:null,concreteType:"PersonalDetails",kind:"LinkedField",name:"personalDetails",plural:!1,selections:[{alias:null,args:null,concreteType:"LegalName",kind:"LinkedField",name:"legalName",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"firstName",storageKey:null}],storageKey:null}],storageKey:null},a=[{kind:"Variable",name:"first",variableName:"conversationCount"},{kind:"Literal",name:"status",value:"OPEN"}],l={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"isClosed",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},s={alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"hasPreviousPage",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"startCursor",storageKey:null}],storageKey:null},u={kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]},d={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c=[{kind:"Literal",name:"last",value:1}],g={alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatWidgetInternalQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"UserProperties",kind:"LinkedField",name:"userProperties",plural:!1,selections:[n],storageKey:null},{alias:null,args:a,concreteType:"ConversationsConnection",kind:"LinkedField",name:"conversations",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"ChatWidgetExistingEntryFragment"},{alias:null,args:null,concreteType:"ConversationEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[l,i,{alias:"events",args:null,concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"__ChatBodyConversationThread_events_connection",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[l,t,r],storageKey:null},o],storageKey:null},s,u],storageKey:null}],storageKey:null}],storageKey:null},u],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatWidgetInternalQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"UserProperties",kind:"LinkedField",name:"userProperties",plural:!1,selections:[n,d],storageKey:null},{alias:null,args:a,concreteType:"ConversationsConnection",kind:"LinkedField",name:"conversations",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[l,{alias:null,args:c,concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"events",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[l,t,{alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null},d],storageKey:null},{alias:null,args:null,concreteType:"MessageContent",kind:"LinkedField",name:"messageContent",plural:!1,selections:[g],storageKey:null},d,{alias:null,args:null,concreteType:"ErrorData",kind:"LinkedField",name:"errorData",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"isFatal",storageKey:null},g,t],storageKey:null},r],storageKey:null},o],storageKey:null},u,s],storageKey:"events(last:1)"},{alias:null,args:c,filters:null,handle:"connection",key:"ChatBodyConversationThread_events",kind:"LinkedHandle",name:"events"},d,i],storageKey:null}],storageKey:null},u],storageKey:null},d],storageKey:null}]},params:{cacheID:"361b020bb3a9f617a2fc74a98fe699db",id:null,metadata:{connection:[{count:null,cursor:null,direction:"backward",path:null}]},name:"ChatWidgetInternalQuery",operationKind:"query",text:"query ChatWidgetInternalQuery(\n  $conversationCount: Int\n) {\n  viewer {\n    userProperties {\n      personalDetails {\n        legalName {\n          firstName\n        }\n      }\n      id\n    }\n    conversations(first: $conversationCount, status: OPEN) {\n      ...ChatWidgetExistingEntryFragment\n      edges {\n        node {\n          uuid\n          isClosed\n          events(last: 1) {\n            edges {\n              node {\n                uuid\n                type\n                id\n                __typename\n              }\n              cursor\n            }\n            pageInfo {\n              hasPreviousPage\n              startCursor\n            }\n          }\n          id\n        }\n      }\n    }\n    id\n  }\n}\n\nfragment ChatWidgetExistingEntryFragment on ConversationsConnection {\n  ...ChatWidgetExistingEntryInnerFragment\n  edges {\n    node {\n      uuid\n      isClosed\n      events(last: 1) {\n        edges {\n          cursor\n          node {\n            type\n            errorData {\n              isFatal\n              message\n              type\n            }\n            id\n          }\n        }\n      }\n      id\n    }\n  }\n}\n\nfragment ChatWidgetExistingEntryInnerFragment on ConversationsConnection {\n  edges {\n    node {\n      uuid\n      events(last: 1) {\n        edges {\n          node {\n            uuid\n            type\n            participant {\n              participantType\n              id\n            }\n            messageContent {\n              message\n            }\n            id\n          }\n        }\n      }\n      id\n    }\n  }\n}\n"}}}();N.hash="ad51a6d0cf2063bb5a1d591a669e6fa5";var w=function(){var e={defaultValue:null,kind:"LocalArgument",name:"after"},n={defaultValue:null,kind:"LocalArgument",name:"before"},a={defaultValue:null,kind:"LocalArgument",name:"conversationUuid"},l={defaultValue:null,kind:"LocalArgument",name:"first"},i={defaultValue:null,kind:"LocalArgument",name:"last"},t=[{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],r={alias:null,args:null,concreteType:"ChatSupportAttribute",kind:"LinkedField",name:"configs",plural:!0,selections:t,storageKey:null},o=[{kind:"Variable",name:"uuid",variableName:"conversationUuid"}],s={alias:null,args:null,kind:"ScalarField",name:"isClosed",storageKey:null},u={alias:null,args:null,concreteType:"ChatSupportAttribute",kind:"LinkedField",name:"additionalMetadata",plural:!0,selections:t,storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},v={alias:null,args:null,concreteType:"ErrorData",kind:"LinkedField",name:"errorData",plural:!1,selections:[c,g,{alias:null,args:null,kind:"ScalarField",name:"isFatal",storageKey:null}],storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},m={alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"displayName",storageKey:null},p],storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},k={alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"endCursor",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasNextPage",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasPreviousPage",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"startCursor",storageKey:null}],storageKey:null},C={kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]},f={kind:"Variable",name:"after",variableName:"after"},b={kind:"Variable",name:"before",variableName:"before"},h={kind:"Variable",name:"first",variableName:"first"},F={kind:"Variable",name:"last",variableName:"last"},S={alias:null,args:null,kind:"ScalarField",name:"label",storageKey:null},E=[f,b,h,F],T={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a,l,i],kind:"Fragment",metadata:null,name:"ChatInternalQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"ChatSupportConfigSettings",kind:"LinkedField",name:"chatSupportConfigSettings",plural:!1,selections:[r],storageKey:null},{alias:null,args:o,concreteType:"ConversationResult",kind:"LinkedField",name:"conversationByUuid",plural:!1,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[s,u,{alias:"events",args:null,concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"__ChatBodyConversationThread_events_connection",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[d,{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[c,u,v,m,y],storageKey:null}],storageKey:null},k,C],storageKey:null}],storageKey:null}],storageKey:null},{args:[f,b,{kind:"Variable",name:"conversationUuid",variableName:"conversationUuid"},h,F],kind:"FragmentSpread",name:"ChatBodyConversationThreadFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,l,e,n,i],kind:"Operation",name:"ChatInternalQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"ChatSupportConfigSettings",kind:"LinkedField",name:"chatSupportConfigSettings",plural:!1,selections:[r,{alias:null,args:null,concreteType:"ChatSupportPIIRegex",kind:"LinkedField",name:"piiRegexList",plural:!0,selections:[S,{alias:null,args:null,kind:"ScalarField",name:"regex",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:o,concreteType:"ConversationResult",kind:"LinkedField",name:"conversationByUuid",plural:!1,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[s,u,{alias:null,args:E,concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"events",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[d,{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[c,u,v,m,p,y,T,{alias:null,args:null,kind:"ScalarField",name:"createTime",storageKey:null},{alias:null,args:null,concreteType:"MessageContent",kind:"LinkedField",name:"messageContent",plural:!1,selections:[g,{alias:null,args:null,concreteType:"QuickReply",kind:"LinkedField",name:"replies",plural:!0,selections:[S,{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"messageToPublish",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementType",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementPayload",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"hasUploadFailed",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isBeingUploaded",storageKey:null}]}],storageKey:null}],storageKey:null},k,C],storageKey:null},{alias:null,args:E,filters:null,handle:"connection",key:"ChatBodyConversationThread_events",kind:"LinkedHandle",name:"events"},p,T],storageKey:null}],storageKey:null},p],storageKey:null}]},params:{cacheID:"4c2ff00a33cf3891b81a23599727140e",id:null,metadata:{connection:[{count:null,cursor:null,direction:"bidirectional",path:["viewer","conversationByUuid","node","events"]}]},name:"ChatInternalQuery",operationKind:"query",text:"query ChatInternalQuery(\n  $conversationUuid: Uuid!\n  $first: Int!\n  $after: String\n  $before: String\n  $last: Int\n) {\n  viewer {\n    chatSupportConfigSettings {\n      configs {\n        key\n        value\n      }\n    }\n    conversationByUuid(uuid: $conversationUuid) {\n      node {\n        isClosed\n        additionalMetadata {\n          key\n          value\n        }\n        events(first: $first, after: $after, before: $before, last: $last) {\n          edges {\n            cursor\n            node {\n              type\n              additionalMetadata {\n                key\n                value\n              }\n              errorData {\n                type\n                message\n                isFatal\n              }\n              participant {\n                participantType\n                displayName\n                id\n              }\n              id\n              __typename\n            }\n          }\n          pageInfo {\n            endCursor\n            hasNextPage\n            hasPreviousPage\n            startCursor\n          }\n        }\n        id\n      }\n    }\n    ...ChatBodyConversationThreadFragment_3HTZqc\n    id\n  }\n}\n\nfragment ChatBodyConversationThreadFragment_3HTZqc on Viewer {\n  chatSupportConfigSettings {\n    piiRegexList {\n      label\n      regex\n    }\n  }\n  conversationByUuid(uuid: $conversationUuid) {\n    node {\n      uuid\n      isClosed\n      events(first: $first, after: $after, before: $before, last: $last) {\n        edges {\n          cursor\n          node {\n            id\n            uuid\n            type\n            createTime\n            participant {\n              participantType\n              id\n            }\n            ...MessageTypeToUIRendererFragment\n            __typename\n          }\n        }\n        pageInfo {\n          endCursor\n          hasNextPage\n          hasPreviousPage\n          startCursor\n        }\n      }\n      id\n    }\n  }\n}\n\nfragment MessageBubbleFragment on ConversationEvent {\n  id\n  uuid\n  participant {\n    id\n    displayName\n    participantType\n  }\n  createTime\n  messageContent {\n    message\n    replies {\n      label\n      link\n      messageToPublish\n    }\n    extraElementType\n    extraElementPayload\n  }\n}\n\nfragment MessageTypeToUIRendererFragment on ConversationEvent {\n  type\n  ...MessageBubbleFragment\n  ...ParticipantBubbleFragment\n}\n\nfragment ParticipantBubbleFragment on ConversationEvent {\n  participant {\n    displayName\n    participantType\n    id\n  }\n}\n"}}}();w.hash="934eee9ab1bf700355e7205a11c4a2c2";var P=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"after"},{defaultValue:null,kind:"LocalArgument",name:"before"},{defaultValue:null,kind:"LocalArgument",name:"conversationUuid"},{defaultValue:null,kind:"LocalArgument",name:"first"},{defaultValue:null,kind:"LocalArgument",name:"last"}],n={kind:"Variable",name:"after",variableName:"after"},a={kind:"Variable",name:"before",variableName:"before"},l={kind:"Variable",name:"first",variableName:"first"},i={kind:"Variable",name:"last",variableName:"last"},t={alias:null,args:null,kind:"ScalarField",name:"label",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},o=[n,a,l,i],s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatBodyConversationThreadFragmentQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:[n,a,{kind:"Variable",name:"conversationUuid",variableName:"conversationUuid"},l,i],kind:"FragmentSpread",name:"ChatBodyConversationThreadFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatBodyConversationThreadFragmentQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"ChatSupportConfigSettings",kind:"LinkedField",name:"chatSupportConfigSettings",plural:!1,selections:[{alias:null,args:null,concreteType:"ChatSupportPIIRegex",kind:"LinkedField",name:"piiRegexList",plural:!0,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"regex",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Variable",name:"uuid",variableName:"conversationUuid"}],concreteType:"ConversationResult",kind:"LinkedField",name:"conversationByUuid",plural:!1,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"isClosed",storageKey:null},{alias:null,args:o,concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"events",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[s,r,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"createTime",storageKey:null},{alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null},s,{alias:null,args:null,kind:"ScalarField",name:"displayName",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"MessageContent",kind:"LinkedField",name:"messageContent",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},{alias:null,args:null,concreteType:"QuickReply",kind:"LinkedField",name:"replies",plural:!0,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"messageToPublish",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementType",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementPayload",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"hasUploadFailed",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isBeingUploaded",storageKey:null}]},{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"endCursor",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasNextPage",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasPreviousPage",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"startCursor",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]}],storageKey:null},{alias:null,args:o,filters:null,handle:"connection",key:"ChatBodyConversationThread_events",kind:"LinkedHandle",name:"events"},s],storageKey:null}],storageKey:null},s],storageKey:null}]},params:{cacheID:"a070a85d6f8f0982d1398fcd90c527e6",id:null,metadata:{},name:"ChatBodyConversationThreadFragmentQuery",operationKind:"query",text:"query ChatBodyConversationThreadFragmentQuery(\n  $after: String\n  $before: String\n  $conversationUuid: Uuid!\n  $first: Int\n  $last: Int\n) {\n  viewer {\n    ...ChatBodyConversationThreadFragment_3HTZqc\n    id\n  }\n}\n\nfragment ChatBodyConversationThreadFragment_3HTZqc on Viewer {\n  chatSupportConfigSettings {\n    piiRegexList {\n      label\n      regex\n    }\n  }\n  conversationByUuid(uuid: $conversationUuid) {\n    node {\n      uuid\n      isClosed\n      events(first: $first, after: $after, before: $before, last: $last) {\n        edges {\n          cursor\n          node {\n            id\n            uuid\n            type\n            createTime\n            participant {\n              participantType\n              id\n            }\n            ...MessageTypeToUIRendererFragment\n            __typename\n          }\n        }\n        pageInfo {\n          endCursor\n          hasNextPage\n          hasPreviousPage\n          startCursor\n        }\n      }\n      id\n    }\n  }\n}\n\nfragment MessageBubbleFragment on ConversationEvent {\n  id\n  uuid\n  participant {\n    id\n    displayName\n    participantType\n  }\n  createTime\n  messageContent {\n    message\n    replies {\n      label\n      link\n      messageToPublish\n    }\n    extraElementType\n    extraElementPayload\n  }\n}\n\nfragment MessageTypeToUIRendererFragment on ConversationEvent {\n  type\n  ...MessageBubbleFragment\n  ...ParticipantBubbleFragment\n}\n\nfragment ParticipantBubbleFragment on ConversationEvent {\n  participant {\n    displayName\n    participantType\n    id\n  }\n}\n"}}}();P.hash="0a1d9c1f787670a5e171f873a7dc3515";var D=function(){var e=["conversationByUuid","node","events"],n={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null};return{argumentDefinitions:[{defaultValue:null,kind:"LocalArgument",name:"after"},{defaultValue:null,kind:"LocalArgument",name:"before"},{defaultValue:null,kind:"LocalArgument",name:"conversationUuid"},{defaultValue:null,kind:"LocalArgument",name:"first"},{defaultValue:null,kind:"LocalArgument",name:"last"}],kind:"Fragment",metadata:{connection:[{count:null,cursor:null,direction:"bidirectional",path:e}],refetch:{connection:{forward:{count:"first",cursor:"after"},backward:{count:"last",cursor:"before"},path:e},fragmentPathInResult:["viewer"],operation:P}},name:"ChatBodyConversationThreadFragment",selections:[{alias:null,args:null,concreteType:"ChatSupportConfigSettings",kind:"LinkedField",name:"chatSupportConfigSettings",plural:!1,selections:[{alias:null,args:null,concreteType:"ChatSupportPIIRegex",kind:"LinkedField",name:"piiRegexList",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"regex",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Variable",name:"uuid",variableName:"conversationUuid"}],concreteType:"ConversationResult",kind:"LinkedField",name:"conversationByUuid",plural:!1,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"isClosed",storageKey:null},{alias:"events",args:null,concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"__ChatBodyConversationThread_events_connection",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},n,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"createTime",storageKey:null},{alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null}],storageKey:null},{args:null,kind:"FragmentSpread",name:"MessageTypeToUIRendererFragment"},{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"endCursor",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasNextPage",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasPreviousPage",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"startCursor",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Viewer",abstractKey:null}}();D.hash="0a1d9c1f787670a5e171f873a7dc3515";var M=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"connections"},{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{kind:"Variable",name:"input",variableName:"input"}],a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},i={kind:"InlineFragment",selections:[l],type:"BadRequestError",abstractKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatBodyCreateConversationEventMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"createConversationEvent",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"conversationEvent",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"MessageTypeToUIRendererFragment"}],storageKey:null}],storageKey:null}],type:"CreateConversationEventSuccess",abstractKey:null},i],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatBodyCreateConversationEventMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"createConversationEvent",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"conversationEvent",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},t,{alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},{alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"displayName",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"createTime",storageKey:null},{alias:null,args:null,concreteType:"MessageContent",kind:"LinkedField",name:"messageContent",plural:!1,selections:[l,{alias:null,args:null,concreteType:"QuickReply",kind:"LinkedField",name:"replies",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"messageToPublish",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementType",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementPayload",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"hasUploadFailed",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isBeingUploaded",storageKey:null}]}],storageKey:null},{alias:null,args:null,filters:null,handle:"appendNode",key:"",kind:"LinkedHandle",name:"node",handleArgs:[{kind:"Variable",name:"connections",variableName:"connections"},{kind:"Literal",name:"edgeTypeName",value:"ConversationEventEdge"}]}],storageKey:null}],type:"CreateConversationEventSuccess",abstractKey:null},i],storageKey:null}]},params:{cacheID:"d4f8eb2c91c9772728ecff8939ce022c",id:null,metadata:{},name:"ChatBodyCreateConversationEventMutation",operationKind:"mutation",text:"mutation ChatBodyCreateConversationEventMutation(\n  $input: CreateConversationEventInput!\n) {\n  createConversationEvent(input: $input) {\n    __typename\n    ... on CreateConversationEventSuccess {\n      conversationEvent {\n        node {\n          ...MessageTypeToUIRendererFragment\n          id\n        }\n      }\n    }\n    ... on BadRequestError {\n      message\n    }\n  }\n}\n\nfragment MessageBubbleFragment on ConversationEvent {\n  id\n  uuid\n  participant {\n    id\n    displayName\n    participantType\n  }\n  createTime\n  messageContent {\n    message\n    replies {\n      label\n      link\n      messageToPublish\n    }\n    extraElementType\n    extraElementPayload\n  }\n}\n\nfragment MessageTypeToUIRendererFragment on ConversationEvent {\n  type\n  ...MessageBubbleFragment\n  ...ParticipantBubbleFragment\n}\n\nfragment ParticipantBubbleFragment on ConversationEvent {\n  participant {\n    displayName\n    participantType\n    id\n  }\n}\n"}}}();M.hash="a6550f5278ae49910a49cdd67fb40f04";var A=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"connections"},{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{kind:"Variable",name:"input",variableName:"input"}],a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},i={kind:"InlineFragment",selections:[l],type:"BadRequestError",abstractKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserInputCreateConversationEventMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"createConversationEvent",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"conversationEvent",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"MessageTypeToUIRendererFragment"}],storageKey:null}],storageKey:null}],type:"CreateConversationEventSuccess",abstractKey:null},i],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserInputCreateConversationEventMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"createConversationEvent",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"conversationEvent",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},t,{alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},{alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"displayName",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"createTime",storageKey:null},{alias:null,args:null,concreteType:"MessageContent",kind:"LinkedField",name:"messageContent",plural:!1,selections:[l,{alias:null,args:null,concreteType:"QuickReply",kind:"LinkedField",name:"replies",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"messageToPublish",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementType",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementPayload",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"hasUploadFailed",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isBeingUploaded",storageKey:null}]}],storageKey:null},{alias:null,args:null,filters:null,handle:"appendNode",key:"",kind:"LinkedHandle",name:"node",handleArgs:[{kind:"Variable",name:"connections",variableName:"connections"},{kind:"Literal",name:"edgeTypeName",value:"ConversationEventEdge"}]}],storageKey:null}],type:"CreateConversationEventSuccess",abstractKey:null},i],storageKey:null}]},params:{cacheID:"b2b75cddc4f9aa38602c888bfe037c7e",id:null,metadata:{},name:"UserInputCreateConversationEventMutation",operationKind:"mutation",text:"mutation UserInputCreateConversationEventMutation(\n  $input: CreateConversationEventInput!\n) {\n  createConversationEvent(input: $input) {\n    __typename\n    ... on CreateConversationEventSuccess {\n      conversationEvent {\n        node {\n          ...MessageTypeToUIRendererFragment\n          id\n        }\n      }\n    }\n    ... on BadRequestError {\n      message\n    }\n  }\n}\n\nfragment MessageBubbleFragment on ConversationEvent {\n  id\n  uuid\n  participant {\n    id\n    displayName\n    participantType\n  }\n  createTime\n  messageContent {\n    message\n    replies {\n      label\n      link\n      messageToPublish\n    }\n    extraElementType\n    extraElementPayload\n  }\n}\n\nfragment MessageTypeToUIRendererFragment on ConversationEvent {\n  type\n  ...MessageBubbleFragment\n  ...ParticipantBubbleFragment\n}\n\nfragment ParticipantBubbleFragment on ConversationEvent {\n  participant {\n    displayName\n    participantType\n    id\n  }\n}\n"}}}();A.hash="56189ab4f0953c6724c71e10b9f3854a";var B="local-id";function R(e,n){return e.get(null!==n&&void 0!==n?n:"")}function O(e,n){var a,l=R(e,n);l&&(null===(a=l.getLinkedRecords("edges"))||void 0===a||a.filter((function(e){var n,a;return null===(n=e.getLinkedRecord("node"))||void 0===n||null===(a=n.getValue("uuid"))||void 0===a?void 0:a.toString().startsWith(B)})).forEach((function(e){var n,a;return t.qB.deleteNode(l,null!==(n=null===e||void 0===e||null===(a=e.getLinkedRecord("node"))||void 0===a?void 0:a.getDataID())&&void 0!==n?n:"")})))}async function j(e,n,a,l,i,r){return new Promise((function(o,s){(0,t.uL)(l,(function(e){O(e,a)})),i({variables:{connections:a?[a]:[],input:{conversationUuid:e,type:"MESSAGE_CONTENT",message:n,inReplyToUuid:r}},optimisticResponse:{createConversationEvent:{__typename:"CreateConversationEventSuccess",conversationEvent:{node:{id:"local-event-id",uuid:"local-uuid",type:"MESSAGE_CONTENT",isBeingUploaded:!0,hasUploadFailed:!1,messageContent:{message:n,replies:[],extraElementPayload:null,extraElementType:null},participant:{id:"local-participant-id",displayName:"",participantType:"USER"},createTime:(new Date).toISOString()}}}},onError:function(e){var i=e.alreadyReportedError;(0,t.uL)(l,(function(e){!function(e,n,a){var l=R(e,a);if(l){var i=e.create("".concat(B,":").concat(Date.now()),"ConversationEvent");i.setValue("".concat(B,":id"),"id"),i.setValue("".concat(B,":uuid"),"uuid"),i.setValue((new Date).toString(),"createTime"),i.setValue("MESSAGE_CONTENT","type"),i.setValue(!0,"hasUploadFailed"),i.getOrCreateLinkedRecord("messageContent","MessageContent").setValue(n,"message"),i.getOrCreateLinkedRecord("participant","Participant").setValue("USER","participantType"),t.qB.insertEdgeAfter(l,t.qB.createEdge(e,l,i,"ConversationEventEdge"))}}(e,n,a)})),s(i)},onCompleted:function(e){var n=e.response;o(n)},updater:function(e,n){var l;"CreateConversationEventSuccess"===(null===(l=n.createConversationEvent)||void 0===l?void 0:l.__typename)&&O(e,a)}})}))}var V=A;function q(e,n){(0,o.b)("cb_chat_send_message",n,{status:e?"success":"failure"})}var H=(0,l.memo)((function(e){var n=e.eventsConnectionId,a=e.piiRegexList,s=e.onChange,u=(0,o.u)().conversationUuid,d=(0,t.ld)(),c=U((0,l.useState)((0,o.a)("LOCAL_STORAGE_CHAT_INPUT_KEY","")),2),g=c[0],v=c[1],p=U((0,l.useState)(!1),2),y=p[0],k=p[1],C=U((0,t.Db)(V),1)[0],f=(0,r.NO)(),b=(0,l.useCallback)((function(e){var n,a,l,i;0===(null!==(n=null===g||void 0===g?void 0:g.length)&&void 0!==n?n:0)&&(null!==(a=null===e||void 0===e?void 0:e.length)&&void 0!==a?a:0)>0?function(e,n){n({variables:{connections:[],input:{conversationUuid:e,type:"STARTED_TYPING"}},onError:function(n){var a=n.alreadyReportedError;(0,o.g)().logError(a,{context:"send_started_typing",severity:"error",isHandled:!1,conversationUuid:e})},onCompleted:function(){}})}(u,C):(null!==(l=null===g||void 0===g?void 0:g.length)&&void 0!==l?l:0)>0&&0===(null!==(i=null===e||void 0===e?void 0:e.length)&&void 0!==i?i:0)&&function(e,n){n({variables:{connections:[],input:{conversationUuid:e,type:"STOPPED_TYPING"}},onError:function(n){var a=n.alreadyReportedError;(0,o.g)().logError(a,{context:"send_stopped_typing",severity:"error",isHandled:!1,conversationUuid:e})},onCompleted:function(){}})}(u,C),v(null!==e&&void 0!==e?e:""),(0,o.s)("LOCAL_STORAGE_CHAT_INPUT_KEY",null!==e&&void 0!==e?e:""),null===s||void 0===s||s(null!==e&&void 0!==e?e:"")}),[u,C,null===g||void 0===g?void 0:g.length,s]),h=(0,l.useCallback)((function(){(0,i.ZD)("cb_chat_message_overall_latency","user-input","existing"),k(!0);var e=g.trim();v(""),j(u,(0,i.Mm)({message:e,regexes:null!==a&&void 0!==a?a:[]}),n,d,C).then((function(e){var n;(0,i.ZD)("cb_chat_message_latency","user-input","existing"),"CreateConversationEventSuccess"===(null===(n=e.createConversationEvent)||void 0===n?void 0:n.__typename)&&((0,o.r)("LOCAL_STORAGE_CHAT_INPUT_KEY"),q(!0,u))})).catch((function(e){(0,i.CV)("cb_chat_message_overall_latency"),f.logError(e,{context:"user_input",severity:"error",isHandled:!0,conversationUuid:u}),q(!1,u)})).finally((function(){k(!1)}))}),[u,C,n,g,a,d,f]);return(0,m.jsx)(o.B,{inputText:null!==g&&void 0!==g?g:"",loading:y,onChangeText:b,onSendMessage:h})})),$=(0,u.vU)({loadingConversationsMessage:{id:"ChatSupport.ChatBody.loadingConversationsMessage",defaultMessage:"Loading older messages",description:"Loading message to show adjacent to spinner when loading older messages scrolling up in chat"}});function W(e,n){(0,o.b)("cb_chat_send_message",n,{action:p.Us.click,componentType:p.re.button,status:e?"success":"failure"})}var G=M,Q=["MESSAGE_CONTENT"],Z=D;function z(e,n){var a;return e.id===(null===(a=L(n).reverse().find((function(e){var n,a;return!(0,i.Qj)(null!==(n=null===(a=e.participant)||void 0===a?void 0:a.participantType)&&void 0!==n?n:"")&&"MESSAGE_CONTENT"===e.type})))||void 0===a?void 0:a.id)}function Y(e,n){var a,l,t,r,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o&&z(e,n)&&((0,i.ej)(null!==(a=null===(l=e.participant)||void 0===l?void 0:l.participantType)&&void 0!==a?a:"")||(0,i.$1)(null!==(t=null===(r=e.participant)||void 0===r?void 0:r.participantType)&&void 0!==t?t:""))}var J=(0,l.memo)((function(e){var n,a,s,u,p,y,k,C,f,b,h,F,S,E,T,K=e.viewer,_=(0,t.ld)(),L=U((0,l.useState)(null),2),x=L[0],I=L[1],N=U((0,l.useState)(0),2),w=N[0],P=N[1],D=U((0,t.Db)(G),1)[0],M=(0,d.Z)().formatMessage,A=(0,o.c)(),B=A.latestEvent,R=A.updateLatestEvent,O=(0,t.nu)(Z,K),V=O.data,q=O.loadPrevious,z=O.isLoadingPrevious,J=O.hasPrevious,X=null===(n=V.conversationByUuid)||void 0===n||null===(a=n.node)||void 0===a?void 0:a.uuid,ee=null===(s=V.conversationByUuid)||void 0===s||null===(u=s.node)||void 0===u||null===(p=u.events)||void 0===p?void 0:p.__id,ne=null!==(y=!(null===(k=V.conversationByUuid)||void 0===k||null===(C=k.node)||void 0===C||!C.isClosed)||(null===(f=V.conversationByUuid)||void 0===f||null===(b=f.node)||void 0===b||null===(h=b.events)||void 0===h?void 0:h.edges.some((function(e){var n;return"CONVERSATION_CLOSED"===(null===(n=e.node)||void 0===n?void 0:n.type)}))))&&void 0!==y&&y,ae=null===(F=V.conversationByUuid)||void 0===F||null===(S=F.node)||void 0===S||null===(E=S.events)||void 0===E?void 0:E.edges,le=(0,l.useMemo)((function(){return(null!==ae&&void 0!==ae?ae:[]).map((function(e){return e.node})).filter((function(e){return null!==e&&(Q.includes(e.type)||function(e){var n,a;return"PARTICIPANT_JOINED"===(null===e||void 0===e?void 0:e.type)&&(0,i.$1)(null!==(n=null===(a=e.participant)||void 0===a?void 0:a.participantType)&&void 0!==n?n:"")}(e))}))}),[ae]),ie=(0,l.useRef)(le.length);(0,l.useEffect)((function(){var e;le.length>=1&&((0,i.b7)("cb_chat_starting_latency",X,{particpantType:null===(e=le[le.length-1].participant)||void 0===e?void 0:e.participantType}),(0,i.b7)("cb_chat_start_latency_loader",X))}),[X,le]);var te=function(e,n){var a,l,t,r,o=e.length,s=e[o-1],u=e[o-2],d=e.length-n;if(d>1){var c=e[o-1-d];return null!==c&&void 0!==c&&c.id?"event-".concat(c.id):void 0}if((null===s||void 0===s||null===(a=s.participant)||void 0===a?void 0:a.participantType)!==(null===u||void 0===u||null===(l=u.participant)||void 0===l?void 0:l.participantType)||(0,i.Io)(null!==(t=null===s||void 0===s||null===(r=s.participant)||void 0===r?void 0:r.participantType)&&void 0!==t?t:""))return null!==s&&void 0!==s&&s.id?"event-".concat(s.id):void 0}(le,ie.current);(0,l.useEffect)((function(){ie.current=le.length}),[le.length]);var re=(0,l.useMemo)((function(){var e,n;return(null!==(e=null===(n=V.chatSupportConfigSettings)||void 0===n?void 0:n.piiRegexList)&&void 0!==e?e:[]).filter(Boolean).map((function(e){return{label:null===e||void 0===e?void 0:e.label,regex:null===e||void 0===e?void 0:e.regex}}))}),[null===(T=V.chatSupportConfigSettings)||void 0===T?void 0:T.piiRegexList]),oe=(0,l.useMemo)((function(){return(null!==ae&&void 0!==ae?ae:[]).filter((function(e){var n,a,l,t;return null!==e.node&&"MESSAGE_CONTENT"===(null===(n=e.node)||void 0===n?void 0:n.type)&&!(0,i.Io)(null!==(a=null===(l=e.node)||void 0===l||null===(t=l.participant)||void 0===t?void 0:t.participantType)&&void 0!==a?a:"")}))}),[ae]),se=(0,l.useMemo)((function(){var e=null!==B&&void 0!==B&&B.uuid?oe.findIndex((function(e){var n;return B.uuid===(null===(n=e.node)||void 0===n?void 0:n.uuid)})):-1;return e<0||e===oe.length-1?0:oe.length-(e+1)}),[null===B||void 0===B?void 0:B.uuid,oe]),ue=(0,l.useCallback)((function(){return!(z||!J)&&(q(o.P),!0)}),[q,z,J]),de=(0,l.useCallback)((function(){var e,n=(0,o.d)(oe);null!==n&&void 0!==n&&n.node&&(null===(e=n.node)||void 0===e?void 0:e.uuid)!==(null===B||void 0===B?void 0:B.uuid)&&R({uuid:n.node.uuid,cursor:n.cursor,createTime:n.node.createTime})}),[null===B||void 0===B?void 0:B.uuid,oe,R]),ce=(0,l.useCallback)((function(){var e;P(null!==(e=null===x||void 0===x?void 0:x.offsetHeight)&&void 0!==e?e:0)}),[null===x||void 0===x?void 0:x.offsetHeight]);(0,l.useEffect)((function(){ce()}),[ce]);var ge=(0,l.useCallback)((function(){ce()}),[ce]),ve=(0,r.NO)(),pe=(0,l.useCallback)((function(e,n){(0,i.ZD)("cb_chat_message_overall_latency","quick-reply","existing"),j(X,(0,i.Mm)({message:e,regexes:null!==re&&void 0!==re?re:[]}),ee,_,D,n).then((function(){(0,i.ZD)("cb_chat_message_latency","message-bubble-data-wrapper","existing"),W(!0,X)})).catch((function(e){(0,i.CV)("cb_chat_message_overall_latency"),W(!1,X),ve.logError(e,{context:"chat_body",severity:"error",isHandled:!0,conversationUuid:X})}))}),[D,ee,re,_,X,ve]),me=(0,l.useCallback)((function(){(0,o.e)("cbchat_scroll_to_bottom",X)}),[X]);return 0===le.length?(0,m.jsx)(o.f,{}):(0,m.jsx)(o.h,{bottomPadding:w,unreadMessageCount:se,shouldRestoreScroll:!z,autoScrollKey:te,onTopReached:ue,onBottomReached:de,onScrollToEndPress:me,children:(0,m.jsxs)(m.Fragment,{children:[z&&(0,m.jsxs)(c.HStack,{justifyContent:"center",alignItems:"center",height:10,spacingVertical:2,children:[(0,m.jsx)(g.$,{size:2}),(0,m.jsx)(v.TextLabel2,{testID:"loading-message",as:"span",color:"foregroundMuted",spacingHorizontal:1,spacingVertical:1,align:"center",children:M($.loadingConversationsMessage)})]}),le.map((function(e){return(0,o.i)(X,e),(0,m.jsx)(o.M,{event:e,conversationId:X,onReplyPress:pe,showQuickReplies:Y(e,le,!(null!==ne&&void 0!==ne&&ne))},e.id)})),ne?null:(0,m.jsx)(c.VStack,{pin:"bottom",width:"100%",ref:I,children:(0,m.jsx)(H,{eventsConnectionId:ee,piiRegexList:re,onChange:ge})},"input-wrapper")]})})})),X=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{kind:"Variable",name:"input",variableName:"input"}],a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},l={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null}],type:"BadRequestError",abstractKey:null},i={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useCreateConversationMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"createConversation",plural:!1,selections:[a,l,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"conversation",plural:!1,selections:[{kind:"RequiredField",field:i,action:"THROW",path:"createConversation.conversation.uuid"}],storageKey:null}],type:"CreateConversationSuccess",abstractKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useCreateConversationMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"createConversation",plural:!1,selections:[a,l,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"conversation",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],type:"CreateConversationSuccess",abstractKey:null}],storageKey:null}]},params:{cacheID:"eb252d4cacde86f141a5b8a28c841750",id:null,metadata:{},name:"useCreateConversationMutation",operationKind:"mutation",text:"mutation useCreateConversationMutation(\n  $input: CreateConversationInput!\n) {\n  createConversation(input: $input) {\n    __typename\n    ... on BadRequestError {\n      message\n      code\n    }\n    ... on CreateConversationSuccess {\n      conversation {\n        uuid\n        id\n      }\n    }\n  }\n}\n"}}}();X.hash="bc5e2f642a9ee8edfbc90515aeaaa381";var ee=X;function ne(e,n){(0,o.b)("cb_chat_create_conversation",n,{status:e?"success":"failure",action:p.Us.view,componentType:p.re.button})}function ae(){var e=U((0,t.Db)(ee),2),n=e[0],a=e[1];return[(0,l.useCallback)((async function(e,a){return new Promise((function(l,i){n({variables:{input:{metadata:e?JSON.stringify(e):void 0}},onError:function(e){var n=e.alreadyReportedError;i(n),ne(!1,null)},onCompleted:function(e){var n,a,t,r,o=e.response;switch(null===(n=o.createConversation)||void 0===n?void 0:n.__typename){case"CreateConversationSuccess":var s,u,d,c,g,v;if(null!==(a=o.createConversation)&&void 0!==a&&null!==(t=a.conversation)&&void 0!==t&&t.uuid)ne(!0,null===(s=o.createConversation)||void 0===s||null===(u=s.conversation)||void 0===u?void 0:u.uuid),l(null===(d=o.createConversation)||void 0===d||null===(c=d.conversation)||void 0===c?void 0:c.uuid);else ne(!1,null),i(new Error("Received invalid conversation ID: ".concat(null===(g=o.createConversation)||void 0===g||null===(v=g.conversation)||void 0===v?void 0:v.uuid)));break;case"BadRequestError":ne(!1,null),i(new Error(o.createConversation.code));break;default:ne(!1,null),i(new Error("Unknown response type: ".concat(null===(r=o.createConversation)||void 0===r?void 0:r.__typename)))}},updater:function(e){var n;a&&(null===(n=e.get(a))||void 0===n||n.invalidateRecord())}})}))}),[n]),a]}function le(e){var n=e.conversationNodeId,a=e.onCreateConversation,t=e.closedConversationUuid,s=(0,o.j)().createConversationParams,u=U(ae(),1)[0],d=U((0,l.useState)("NONE"),2),c=d[0],g=d[1],v=(0,r.NO)(),p=(0,l.useCallback)((function(){(0,i.ZD)("cb_chat_starting_latency","new-chat-closecard-button","new"),(0,o.e)("cbchat_conversation_close_start_conversation",t),g("LOADING"),u(s,n).then((function(e){(0,i.ZD)("cb_chat_start_latency_loader","new-chat-closecard-button","new"),g("NONE"),null===a||void 0===a||a(e)})).catch((function(e){v.logError(e,{context:"chat_closed",severity:"error",isHandled:!0}),g("FAILED")}))}),[t,n,u,s,a,v]);return(0,m.jsx)(o.k,{onCreateNewConversation:p,conversationCreationStatus:c})}var ie=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"connections"},{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{kind:"Variable",name:"input",variableName:"input"}],a={alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},i={alias:null,args:null,concreteType:"ChatSupportAttribute",kind:"LinkedField",name:"additionalMetadata",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},o={alias:null,args:null,concreteType:"ErrorData",kind:"LinkedField",name:"errorData",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"isFatal",storageKey:null},t,r],storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},u={alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"conversation",plural:!1,selections:[s,l,{alias:null,args:null,kind:"ScalarField",name:"isClosed",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatEventSubscriberSubscription",selections:[{alias:"event",args:n,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"subscribeConversationEventsByConversation",plural:!1,selections:[a,{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[l,i,o,u,{args:null,kind:"FragmentSpread",name:"MessageTypeToUIRendererFragment"}],storageKey:null}],storageKey:null}],type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatEventSubscriberSubscription",selections:[{alias:"event",args:n,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"subscribeConversationEventsByConversation",plural:!1,selections:[a,{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[l,i,o,u,t,s,{alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[s,{alias:null,args:null,kind:"ScalarField",name:"displayName",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"createTime",storageKey:null},{alias:null,args:null,concreteType:"MessageContent",kind:"LinkedField",name:"messageContent",plural:!1,selections:[r,{alias:null,args:null,concreteType:"QuickReply",kind:"LinkedField",name:"replies",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"messageToPublish",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementType",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extraElementPayload",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"hasUploadFailed",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isBeingUploaded",storageKey:null}]}],storageKey:null},{alias:null,args:null,filters:null,handle:"appendNode",key:"",kind:"LinkedHandle",name:"node",handleArgs:[{kind:"Variable",name:"connections",variableName:"connections"},{kind:"Literal",name:"edgeTypeName",value:"ConversationEventEdge"}]}],storageKey:null}]},params:{cacheID:"f00c8223f2bc621286dfb7d7072bb9a6",id:null,metadata:{},name:"ChatEventSubscriberSubscription",operationKind:"subscription",text:"subscription ChatEventSubscriberSubscription(\n  $input: SubscribeEventsByConversationInput!\n) {\n  event: subscribeConversationEventsByConversation(input: $input) {\n    cursor\n    node {\n      uuid\n      additionalMetadata {\n        key\n        value\n      }\n      errorData {\n        isFatal\n        type\n        message\n      }\n      conversation {\n        id\n        uuid\n        isClosed\n      }\n      ...MessageTypeToUIRendererFragment\n      id\n    }\n  }\n}\n\nfragment MessageBubbleFragment on ConversationEvent {\n  id\n  uuid\n  participant {\n    id\n    displayName\n    participantType\n  }\n  createTime\n  messageContent {\n    message\n    replies {\n      label\n      link\n      messageToPublish\n    }\n    extraElementType\n    extraElementPayload\n  }\n}\n\nfragment MessageTypeToUIRendererFragment on ConversationEvent {\n  type\n  ...MessageBubbleFragment\n  ...ParticipantBubbleFragment\n}\n\nfragment ParticipantBubbleFragment on ConversationEvent {\n  participant {\n    displayName\n    participantType\n    id\n  }\n}\n"}}}();ie.hash="028e4100bf2f8b18b7a48c8533c41eaf";var te=ie;function re(e){var n=e.conversationUuid,a=e.after,l=e.eventsConnectionId;return(0,e.children)((0,o.n)({query:te,conversationUuid:n,after:a,eventsConnectionId:l}))}function oe(e){var n=e.children,a=(0,o.l)(),l=(0,o.m)();return a&&l?(0,m.jsx)(re,K({},e)):n(!1)}var se=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:null,kind:"LinkedField",name:"createConversationEvent",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"conversationEvent",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null}],storageKey:null}],storageKey:null}],type:"CreateConversationEventSuccess",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null}],type:"BadRequestError",abstractKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatHeaderSoftCloseMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatHeaderSoftCloseMutation",selections:n},params:{cacheID:"86ba23874a8ccd3717bf7137c85eb1a0",id:null,metadata:{},name:"ChatHeaderSoftCloseMutation",operationKind:"mutation",text:"mutation ChatHeaderSoftCloseMutation(\n  $input: CreateConversationEventInput!\n) {\n  createConversationEvent(input: $input) {\n    __typename\n    ... on CreateConversationEventSuccess {\n      conversationEvent {\n        cursor\n        node {\n          id\n          uuid\n          type\n        }\n      }\n    }\n    ... on BadRequestError {\n      __typename\n      code\n      message\n    }\n  }\n}\n"}}}();se.hash="7e03edf84a330e8848a77eecf77ec58a";var ue=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"conversationUuid"}],n=[{fields:[{kind:"Literal",name:"closed",value:!0},{kind:"Variable",name:"conversationUuid",variableName:"conversationUuid"}],kind:"ObjectValue",name:"input"}],a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"isClosed",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatHeaderForceCloseMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"updateConversation",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"conversation",plural:!1,selections:[l],storageKey:null}],type:"UpdateConversationSuccess",abstractKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatHeaderForceCloseMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"updateConversation",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"conversation",plural:!1,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],type:"UpdateConversationSuccess",abstractKey:null}],storageKey:null}]},params:{cacheID:"18653b023ce08373df09f5d663f67a53",id:null,metadata:{},name:"ChatHeaderForceCloseMutation",operationKind:"mutation",text:"mutation ChatHeaderForceCloseMutation(\n  $conversationUuid: String!\n) {\n  updateConversation(input: {conversationUuid: $conversationUuid, closed: true}) {\n    __typename\n    ... on UpdateConversationSuccess {\n      conversation {\n        isClosed\n        id\n      }\n    }\n  }\n}\n"}}}();ue.hash="dd9f91027f5e7e271f4c94d553d6ca02";var de=ue,ce=se,ge=(0,l.memo)((function(e){var n=e.agentParticipant,a=e.isAgentActive,s=e.config,u=e.conversationUuid,d=e.isConversationClosed,c=void 0!==d&&d,g=e.isTyping,v=e.isSurveyModeEnabled,p=U((0,l.useState)(!1),2),y=p[0],k=p[1],C=U((0,t.Db)(ce),2),f=C[0],b=C[1],h=U((0,t.Db)(de),2),F=h[0],S=h[1],E=(0,r.NO)(),T=(0,l.useCallback)((function(){y||v?((0,o.e)("cbchat_tray_end_conversation_force",u),F({variables:{conversationUuid:u},onCompleted:function(e){var n=e.response.updateConversation;null===n||void 0===n||n.__typename},onError:function(e){var n=e.alreadyReportedError;E.logError(n,{context:"chat_header",severity:"error",isHandled:!1,conversationUuid:u})}})):((0,o.e)("cbchat_tray_end_conversation_soft",u),k(!0),(0,i.ZD)("cb_chat_message_overall_latency","end-chat-button","existing"),f({variables:{input:{conversationUuid:u,type:"INTENT_TO_CLOSE"}},onCompleted:function(e){var n=e.response.createConversationEvent;"CreateConversationEventSuccess"===(null===n||void 0===n?void 0:n.__typename)&&(0,i.ZD)("cb_chat_message_latency","end-chat-button","existing")},onError:function(e){var n=e.alreadyReportedError;(0,i.CV)("cb_chat_message_overall_latency"),E.logError(n,{context:"chat_header",severity:"error",isHandled:!1,conversationUuid:u})}}))}),[y,v,u,F,f,E]);return(0,m.jsx)(o.o,{conversationUuid:u,isConversationClosed:c,config:s,agentParticipant:n,isAgentActive:a,isTyping:g,isClosingConversation:b||S,onCloseConversation:T})})),ve=(0,u.vU)({conversationUuidLabel:{id:"DebugModeUI.conversationUuidLabel",defaultMessage:"Conversation UUID: {conversationUuid}",description:"Conversation UUID field"}});function pe(){var e=(0,d.Z)().formatMessage,n=(0,o.j)().enableDebugMode,a=void 0!==n&&n,l=(0,o.u)().conversationUuid;return a?(0,m.jsx)(y.Box,{spacing:1,width:"100%",children:(0,m.jsx)(y.Box,{bordered:!0,width:"100%",spacing:1,children:(0,m.jsx)(k.TextLegal,{as:"p",children:e(ve.conversationUuidLabel,{conversationUuid:l})})})}):null}function me(){}var ye=w;function ke(e){var n,a,t,u,d,c,g,v,p,y,k,C,f,b,h,F,S,E,T,K,_=e.queryData,L=e.conversationNodeId,U=e.isSubscriptionActive,x=e.onCreateConversation,I=(0,o.u)(),N=I.conversationUuid,w=I.onCollapse,P=null===(n=_.viewer.conversationByUuid)||void 0===n?void 0:n.node,D=null===(a=_.viewer.conversationByUuid)||void 0===a||null===(t=a.node)||void 0===t?void 0:t.additionalMetadata,M=null===D||void 0===D?void 0:D.find((function(e){return"isLpSurveyStarted"===(null===e||void 0===e?void 0:e.key)})),A="true"===(null===M||void 0===M?void 0:M.value),B=(0,o.d)(null!==(u=null===(d=_.viewer.conversationByUuid)||void 0===d||null===(c=d.node)||void 0===c||null===(g=c.events)||void 0===g?void 0:g.edges.filter((function(e){var n,a,l,t;return"PARTICIPANT_JOINED"===(null===(n=e.node)||void 0===n?void 0:n.type)&&(0,i.$1)(null!==(a=null===(l=e.node)||void 0===l||null===(t=l.participant)||void 0===t?void 0:t.participantType)&&void 0!==a?a:"")})).map((function(e){var n;return null===(n=e.node)||void 0===n?void 0:n.participant})))&&void 0!==u?u:[]),R=B&&(null===(v=_.viewer.conversationByUuid)||void 0===v||null===(p=v.node)||void 0===p||null===(y=p.events)||void 0===y?void 0:y.edges.every((function(e){var n,a,l;return"PARTICIPANT_LEFT"!==(null===(n=e.node)||void 0===n?void 0:n.type)||(null===(a=e.node)||void 0===a||null===(l=a.participant)||void 0===l?void 0:l.id)!==(null===B||void 0===B?void 0:B.id)}))),O=(0,i.$D)(null!==(k=null===(C=_.viewer.chatSupportConfigSettings)||void 0===C?void 0:C.configs)&&void 0!==k?k:null),j=function(e){var n,a,l,t=!1;return null===(n=e.viewer.conversationByUuid)||void 0===n||null===(a=n.node)||void 0===a||null===(l=a.events)||void 0===l||l.edges.forEach((function(e){var n,a,l,r,o,s,u,d,c;"STARTED_TYPING"!==(null===(n=e.node)||void 0===n?void 0:n.type)||(0,i.Io)(null!==(a=null===(l=e.node)||void 0===l||null===(r=l.participant)||void 0===r?void 0:r.participantType)&&void 0!==a?a:"")?"STOPPED_TYPING"!==(null===(o=e.node)||void 0===o?void 0:o.type)&&"MESSAGE_CONTENT"!==(null===(s=e.node)||void 0===s?void 0:s.type)||(0,i.Io)(null!==(u=null===(d=e.node)||void 0===d||null===(c=d.participant)||void 0===c?void 0:c.participantType)&&void 0!==u?u:"")||(t=!1):t=!0})),t}(_),V=null!==(f=null===(b=_.viewer.conversationByUuid)||void 0===b||null===(h=b.node)||void 0===h||null===(F=h.events)||void 0===F?void 0:F.edges.some((function(e){var n,a,l,i;return"CONVERSATION_UPDATED"===(null===(n=e.node)||void 0===n?void 0:n.type)&&"true"===(null===(a=e.node)||void 0===a||null===(l=a.additionalMetadata)||void 0===l||null===(i=l.find((function(e){return"isLpSurveyStarted"===(null===e||void 0===e?void 0:e.key)})))||void 0===i?void 0:i.value)})))&&void 0!==f&&f,q=null!==(S=!(null===P||void 0===P||!P.isClosed)||(null===(E=_.viewer.conversationByUuid)||void 0===E||null===(T=E.node)||void 0===T||null===(K=T.events)||void 0===K?void 0:K.edges.some((function(e){var n;return"CONVERSATION_CLOSED"===(null===(n=e.node)||void 0===n?void 0:n.type)}))))&&void 0!==S&&S,H=(0,r.NO)(),$=(0,l.useCallback)((function(){H.logError(new Error("User sees Connection Trouble card"),{context:"chat_internal",severity:"error",isHandled:!1,isUserVisible:!0,conversationUuid:N,visibilityState:document.visibilityState})}),[H,N]),W=!q&&!U,G=(0,o.j)().layout;return(0,m.jsxs)(o.W,{layout:G,isConversationClosed:q,children:[(0,m.jsx)(ge,{conversationUuid:N,isConversationClosed:q,config:O,isSurveyModeEnabled:A||V,agentParticipant:B,isAgentActive:!!R,isTyping:j}),(0,m.jsx)(s.Divider,{}),(0,m.jsx)(pe,{}),(0,m.jsx)(J,{viewer:null===_||void 0===_?void 0:_.viewer}),W?(0,m.jsx)(o.q,{onCloseChat:null!==w&&void 0!==w?w:me,onOpen:$}):null,q&&(0,m.jsx)(le,{closedConversationUuid:N,conversationNodeId:L,onCreateConversation:x})]})}function Ce(e){var n,a,l,i,t,r,s,u,d=e.queryData,c=(0,o.u)().conversationUuid;return(0,o.j)().isDisabled?(0,m.jsx)(ke,{queryData:d,isSubscriptionActive:!1}):(0,m.jsx)(oe,{conversationUuid:c,after:null!==(n=null===(a=(0,o.d)(null===d||void 0===d||null===(l=d.viewer.conversationByUuid)||void 0===l||null===(i=l.node)||void 0===i||null===(t=i.events)||void 0===t?void 0:t.edges.filter((function(e){return Boolean(e.cursor)}))))||void 0===a?void 0:a.cursor)&&void 0!==n?n:void 0,eventsConnectionId:null===(r=d.viewer.conversationByUuid)||void 0===r||null===(s=r.node)||void 0===s||null===(u=s.events)||void 0===u?void 0:u.__id,children:function(e){return(0,m.jsx)(ke,{queryData:d,isSubscriptionActive:e})}})}var fe=(0,l.memo)((function(e){var n,a,i,r,s,u,d,c=(0,o.u)().conversationUuid,g=(0,o.p)().queryFetchKey,v=(0,l.useMemo)((function(){return{fetchKey:g,fetchPolicy:g>0?"store-and-network":void 0}}),[g]),p=(0,t.pp)(ye,{conversationUuid:c,first:o.P},v),y=null===(n=Boolean(c)&&!(null!==(a=p.viewer.conversationByUuid)&&void 0!==a&&null!==(i=a.node)&&void 0!==i&&i.isClosed)&&(null===(r=p.viewer.conversationByUuid)||void 0===r||null===(s=r.node)||void 0===s||null===(u=s.events)||void 0===u||null===(d=u.edges)||void 0===d?void 0:d.every((function(e){var n,a,l,i=e.node;return"CONVERSATION_CLOSED"!==(null===i||void 0===i?void 0:i.type)&&!(null!==i&&void 0!==i&&null!==(n=i.errorData)&&void 0!==n&&n.isFatal)&&!("ERROR"===(null===i||void 0===i?void 0:i.type)&&"SubscriptionError"===(null===(a=i.errorData)||void 0===a?void 0:a.type)&&"Conversation Closed"===(null===(l=i.errorData)||void 0===l?void 0:l.message))}))))||void 0===n||n;return y?(0,m.jsx)(Ce,{queryData:p}):(0,m.jsx)(ke,K({queryData:p},e))})),be=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{kind:"Variable",name:"input",variableName:"input"}],a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},i=[{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null}],t={kind:"InlineFragment",selections:i,type:"BadRequestError",abstractKey:null},r={kind:"InlineFragment",selections:i,type:"Error",abstractKey:"__isError"};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatStepUpAuthExecutorMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"upgradeConversation",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"conversation",plural:!1,selections:[l],storageKey:null}],type:"UpgradeConversationSuccess",abstractKey:null},t,r],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatStepUpAuthExecutorMutation",selections:[{alias:null,args:n,concreteType:null,kind:"LinkedField",name:"upgradeConversation",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"conversation",plural:!1,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],type:"UpgradeConversationSuccess",abstractKey:null},t,r],storageKey:null}]},params:{cacheID:"a7a34a505e92dd79f039f1866b78bfbd",id:null,metadata:{},name:"ChatStepUpAuthExecutorMutation",operationKind:"mutation",text:"mutation ChatStepUpAuthExecutorMutation(\n  $input: UpgradeConversationInput!\n) {\n  upgradeConversation(input: $input) {\n    __typename\n    ... on UpgradeConversationSuccess {\n      conversation {\n        uuid\n        id\n      }\n    }\n    ... on BadRequestError {\n      message\n      code\n    }\n    ... on Error {\n      __isError: __typename\n      message\n      code\n    }\n  }\n}\n"}}}();function he(){}be.hash="ece032ce69ce358bb973adbebdab2607";var Fe=be;function Se(e){var n=e.conversationUuid,a=e.guestUserUuid,i=e.stepUpAuthSource,s=e.errorFallback,u=e.loadingFallback,d=e.successFallback,c=U((0,l.useState)("LOADING"),2),g=c[0],v=c[1],p=U((0,t.Db)(Fe),1)[0],m=U((0,l.useState)(0),2),y=m[0],k=m[1],C=(0,l.useCallback)((function(){return k((function(e){return e+1}))}),[]),f=(0,r.NO)();switch((0,l.useEffect)((function(){return y>=5?(f.logError(new Error("Reached retry limit"),{context:"auth_executor",severity:"crash",isHandled:!0,isUserVisible:!0,conversationUuid:n,guestUserUuid:a,stepUpAuthSource:i}),v("FAILED"),he):p({variables:{input:{conversationUuid:n,guestUserUuid:a,metadata:i?JSON.stringify({auth_source:i}):void 0}},onError:function(e){var l=e.alreadyReportedError;f.logError(l,{context:"auth_executor",severity:"error",isHandled:!0,conversationUuid:n,guestUserUuid:a,stepUpAuthSource:i}),C()},onCompleted:function(e){var l,t,r,s=e.response;switch(null===(l=s.upgradeConversation)||void 0===l?void 0:l.__typename){case"UpgradeConversationSuccess":return void(0,o.t)().catch((function(e){return f.logError(e,{context:"auth_executor",severity:"error",isHandled:!0,conversationUuid:n,guestUserUuid:a,stepUpAuthSource:i})})).finally((function(){return v("SUCCESS")}));case"BadRequestError":return f.logError(new Error(null===(t=s.upgradeConversation)||void 0===t?void 0:t.message),{context:"auth_executor",severity:"error",isHandled:!0,conversationUuid:n,guestUserUuid:a,stepUpAuthSource:i,errorCode:null===(r=s.upgradeConversation)||void 0===r?void 0:r.code}),void C();default:f.logError(new Error("Unknown"),{context:"auth_executor",severity:"error",isHandled:!0,conversationUuid:n,guestUserUuid:a,stepUpAuthSource:i}),C()}}}).dispose}),[n,a,p,y,C,i,f]),g){case"LOADING":return u;case"SUCCESS":return d;default:return s}}function Ee(e){var n=U((0,l.useState)("LOADING"),2),a=n[0],i=n[1],t=U((0,l.useState)(),2),s=t[0],u=t[1],d=null!==s&&void 0!==s?s:{},c=d.conversationUuid,g=d.guestUserUuid,v=d.stepUpAuthSource,p=(0,r.NO)();return(0,l.useEffect)((function(){!async function(){try{u(await(0,o.v)()),i("SUCCESS")}catch(e){e instanceof Error&&(p.logError(e,{context:"auth_executor",severity:"error",isHandled:!0}),i("FAILED"))}}()}),[p]),"LOADING"===a?e.loadingFallback:c||g?"SUCCESS"===a&&c&&g?(0,m.jsx)(Se,K({conversationUuid:c,guestUserUuid:g,stepUpAuthSource:v},e)):e.errorFallback:e.skipFallback}var Te=(0,u.vU)({cardTitle:{id:"ChatStepUpAuthFailedCard.cardTitle",defaultMessage:"This chat is currently unavailable.",description:"Title of card that appears when step-up authentication fails"},cardSubtitle:{id:"ChatStepUpAuthFailedCard.cardSubtitle",defaultMessage:"In the meantime, please visit the Help Center.",description:"Subtitle of card that appears when step-up authentication fails"},helpCenterCtaButton:{id:"ChatStepUpAuthFailedCard.helpCenterCtaButton",defaultMessage:"Go to Help Center",description:"Action to trigger page redirect to help.coinbase.com"},startNewChatCtaButton:{id:"ChatStepUpAuthFailedCard.startNewChatCtaButton",defaultMessage:"Start new chat",description:"Action to start new chat"}});function Ke(e){var n=e.conversationUuid,a=e.guestUserUuid,i=e.isStartNewChatLoading,t=void 0!==i&&i,s=e.onStartNewChatPress,u=(0,d.Z)().formatMessage,c=(0,r.NO)();return(0,l.useEffect)((function(){c.logError(new Error("User sees ChatStepUpAuthFailedCard"),{context:"chat_step_up_auth_failed",severity:"critical",isHandled:!0,conversationUuid:n,guestUserUuid:a})}),[n,c,a]),(0,m.jsx)(y.Box,{position:"absolute",background:"backgroundOverlay",width:"100%",height:"100%",borderRadius:"roundedLarge",bordered:!1,zIndex:10,children:(0,m.jsx)(f.Card,{pin:"bottom",elevation:1,spacingVertical:3,spacingHorizontal:3,borderRadius:"roundedLarge",background:"background",children:(0,m.jsxs)(F.VStack,{gap:3,children:[(0,m.jsxs)(F.VStack,{gap:1,children:[(0,m.jsxs)(h.HStack,{alignItems:"center",gap:1,children:[(0,m.jsx)(b.Icon,{name:"error",size:"s",color:"negative",testID:"error-icon"}),(0,m.jsx)(S.TextTitle3,{as:"h3",color:"negative",children:u(Te.cardTitle)})]}),(0,m.jsx)(v.TextLabel2,{align:"center",as:"p",color:"foregroundMuted",children:u(Te.cardSubtitle)})]}),(0,m.jsxs)(F.VStack,{gap:2,width:"100%",children:[(0,m.jsx)(C.Button,{block:!0,variant:"secondary",to:(0,o.w)(),children:u(Te.helpCenterCtaButton)}),(0,m.jsx)(C.Button,{block:!0,variant:"primary",loading:t,onPress:s,children:u(Te.startNewChatCtaButton)})]})]})})})}function _e(e){var n=e.onCreateConversation,a=(0,r.NO)(),t=(0,o.j)(),u=t.createConversationParams,d=t.layout,c=U(ae(),2),g=c[0],v=c[1],p=(0,l.useCallback)((function(){(0,i.ZD)("cb_chat_starting_latency","new-chat-step-up-failed-button","new"),(0,o.t)().catch((function(e){a.logError(e,{context:"chat_step_up_auth_failed_delete_unauth_chat_uuid",severity:"warning",isHandled:!1})})).finally((function(){g(u).then((function(e){(0,i.ZD)("cb_chat_start_latency_loader","new-chat-step-up-failed-button","new"),null===n||void 0===n||n(e)})).catch((function(e){a.logError(e,{context:"chat_step_up_auth_failed_start_new_chat",severity:"critical",isHandled:!1})}))}))}),[g,u,a,n]);return(0,m.jsxs)(o.W,{layout:d,isConversationClosed:!1,children:[(0,m.jsx)(o.o,{conversationUuid:"",isConversationClosed:!1,config:null,isAgentActive:!1,isTyping:!1,agentParticipant:void 0,isClosingConversation:!1}),(0,m.jsx)(s.Divider,{}),(0,m.jsx)(Ke,{onStartNewChatPress:p,isStartNewChatLoading:v})]})}var Le=function(){var e={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatWidgetExistingEntryFragment",selections:[{args:null,kind:"FragmentSpread",name:"ChatWidgetExistingEntryInnerFragment"},{alias:null,args:null,concreteType:"ConversationEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isClosed",storageKey:null},{alias:null,args:[{kind:"Literal",name:"last",value:1}],concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"events",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null},{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[e,{alias:null,args:null,concreteType:"ErrorData",kind:"LinkedField",name:"errorData",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"isFatal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},e],storageKey:null}],storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]}],storageKey:"events(last:1)"}],storageKey:null}],storageKey:null}],type:"ConversationsConnection",abstractKey:null}}();Le.hash="a3e2ac4a7e190873191487d39f23d48f";var Ue=function(){var e={alias:null,args:null,kind:"ScalarField",name:"uuid",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatWidgetExistingEntryInnerFragment",selections:[{alias:null,args:null,concreteType:"ConversationEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Conversation",kind:"LinkedField",name:"node",plural:!1,selections:[e,{alias:null,args:[{kind:"Literal",name:"last",value:1}],concreteType:"ConversationEventsConnection",kind:"LinkedField",name:"events",plural:!1,selections:[{alias:null,args:null,concreteType:"ConversationEventEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"ConversationEvent",kind:"LinkedField",name:"node",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,concreteType:"Participant",kind:"LinkedField",name:"participant",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"participantType",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"MessageContent",kind:"LinkedField",name:"messageContent",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:"events(last:1)"}],storageKey:null}],storageKey:null}],type:"ConversationsConnection",abstractKey:null}}();Ue.hash="3ebccf5b6701465f7b7613f1cbc7b5dd";var xe=Ue;function Ie(e){var n,a,r,s,u,d,c,g,v,y=e.queryData,k=(0,t.Jc)(xe,y),C=(0,o.x)().toggleChatOpen,f=(0,o.c)().latestEvent,b=null===(n=(0,o.d)(null===k||void 0===k?void 0:k.edges))||void 0===n?void 0:n.node,h=(0,l.useMemo)((function(){var e,n;return null!==(e=null===b||void 0===b||null===(n=b.events)||void 0===n?void 0:n.edges.filter((function(e){var n,a,l=e.node;return"MESSAGE_CONTENT"===(null===l||void 0===l?void 0:l.type)&&!(0,i.Io)(null!==(n=null===l||void 0===l||null===(a=l.participant)||void 0===a?void 0:a.participantType)&&void 0!==n?n:"")})))&&void 0!==e?e:[]}),[b]),F=(0,l.useMemo)((function(){var e=null!==f&&void 0!==f&&f.uuid?h.findIndex((function(e){var n;return f.uuid===(null===e||void 0===e||null===(n=e.node)||void 0===n?void 0:n.uuid)})):-1;return e<0||e===h.length-1?0:h.length-(e+1)}),[null===f||void 0===f?void 0:f.uuid,h]),S=(0,l.useCallback)((function(){C(),(0,o.e)("cb_chat_entry_press",null===b||void 0===b?void 0:b.uuid,{type:"existing"}),(0,i.ZD)("cb_chat_start_latency_loader","new-chat-start-button","existing"),(0,i.ZD)("cb_chat_starting_latency","new-chat-start-button","existing")}),[null===b||void 0===b?void 0:b.uuid,C]);return(0,i.FI)((function(){var e;(0,o.y)("cb_chat_entry_impression",{componentType:p.re.button,action:p.Us.view,conversation_id:null!==(e=null===b||void 0===b?void 0:b.uuid)&&void 0!==e?e:"",chat_status:"existing"})})),(0,m.jsx)(o.z,{lastReceivedMessageParticipantType:null!==(a=null===(r=(0,o.d)(h))||void 0===r||null===(s=r.node)||void 0===s||null===(u=s.participant)||void 0===u?void 0:u.participantType)&&void 0!==a?a:"",unreadMessageCount:F,messagePromptText:F>0&&null!==(d=null===(c=(0,o.d)(h))||void 0===c||null===(g=c.node)||void 0===g||null===(v=g.messageContent)||void 0===v?void 0:v.message)&&void 0!==d?d:void 0,onPress:S})}var Ne=Le;function we(e){var n,a,l,i,r,s,u,d=e.queryData,c=(0,t.Jc)(Ne,d),g=null===(n=(0,o.d)(null===c||void 0===c?void 0:c.edges))||void 0===n?void 0:n.node,v=function(e){var n,a;return!!e&&Boolean(e.uuid&&!e.isClosed&&(null===(n=e.events)||void 0===n||null===(a=n.edges)||void 0===a?void 0:a.every((function(e){var n,a,l,i=e.node;return!(null!==i&&void 0!==i&&null!==(n=i.errorData)&&void 0!==n&&n.isFatal)&&!("ERROR"===(null===i||void 0===i?void 0:i.type)&&"SubscriptionError"===(null===(a=i.errorData)||void 0===a?void 0:a.type)&&"Conversation Closed"===(null===(l=i.errorData)||void 0===l?void 0:l.message))}))))}(g);return v?(0,m.jsx)(oe,{conversationUuid:null!==(a=null===g||void 0===g?void 0:g.uuid)&&void 0!==a?a:"",after:null!==(l=null===(i=(0,o.d)(null===g||void 0===g||null===(r=g.events)||void 0===r||null===(s=r.edges)||void 0===s?void 0:s.filter((function(e){return Boolean(e.cursor)}))))||void 0===i?void 0:i.cursor)&&void 0!==l?l:void 0,eventsConnectionId:null===g||void 0===g||null===(u=g.events)||void 0===u?void 0:u.__id,children:function(){return(0,m.jsx)(Ie,{queryData:c})}}):(0,m.jsx)(Ie,{queryData:c})}var Pe=(0,u.vU)({defaultWelcomeMessage:{id:"ChatWidgetFreshEntry.defaultWelcomeMessage",defaultMessage:"Hi \ud83d\udc4b\ud83c\udffb, I\u2019m your Coinbase Assistant. Is there anything I can help you with today?",description:"Default welcome message shown for Chat widget button"},userWelcomeMessage:{id:"ChatWidgetFreshEntry.userWelcomeMessage",defaultMessage:"Hi {userName} \ud83d\udc4b\ud83c\udffb, I\u2019m your Coinbase Assistant. Is there anything I can help you with today?",description:"Welcome message with user first name name shown for Chat widget button"},errorMessage:{id:"ChatWidgetFreshEntry.errorMessage",defaultMessage:"Something went wrong. Please refresh the page, or try again later.",description:"Error message indicating that starting a new chat failed"}});function De(e){var n=e.onCreateConversation,a=e.conversationNodeId,t=e.userName,s=(0,d.Z)().formatMessage,u=(0,o.x)().toggleChatOpen,c=(0,o.j)(),g=c.createConversationParams,v=c.greetingMessage,y=U((0,l.useState)("NONE"),2),k=y[0],C=y[1],f=U(ae(),1)[0],b=(0,r.NO)(),h=(0,l.useCallback)((function(){(0,o.b)("cb_chat_entry_press",null,{type:"new",action:p.Us.click,componentType:p.re.button}),(0,i.ZD)("cb_chat_starting_latency","new-chat-start-button","new"),C("NONE"),f(g,a).then((function(e){(0,i.ZD)("cb_chat_start_latency_loader","new-chat-start-button","new"),C("NONE"),null===n||void 0===n||n(e),u()})).catch((function(e){b.logError(e,K({context:"fresh_entry",severity:"error",isHandled:!1},g)),C("FAILED")}))}),[a,f,g,n,u,b]);(0,i.FI)((function(){(0,o.y)("cb_chat_entry_impression",{componentType:p.re.button,action:p.Us.view,chat_status:"new"})}));var F=(0,l.useMemo)((function(){return"FAILED"===k?s(Pe.errorMessage):"undefined"!==typeof v?v:t?s(Pe.userWelcomeMessage,{userName:t}):s(Pe.defaultWelcomeMessage)}),[k,s,v,t]);return(0,m.jsx)(o.z,{messagePromptText:F,loading:"LOADING"===k,onPress:h})}var Me=N;function Ae(){var e,n,a,s,u,d,c,g,v,p=U((0,l.useState)(0),2),y=p[0],k=p[1],C=(0,l.useCallback)((function(){return k((function(e){return e+1}))}),[]),f=(0,t.pp)(Me,{conversationCount:1},{fetchKey:y}),b=null===(e=(0,o.d)(null===(n=f.viewer.conversations)||void 0===n?void 0:n.edges))||void 0===e?void 0:e.node,h=(null===b||void 0===b?void 0:b.isClosed)||(null===b||void 0===b||null===(a=b.events)||void 0===a?void 0:a.edges.some((function(e){var n=e.node;return"CONVERSATION_CLOSED"===(null===n||void 0===n?void 0:n.type)}))),F=(0,o.j)(),S=F.visible,E=void 0===S||S,T=F.onInit,_=F.isDisabled,L=void 0!==_&&_,x=F.layout,I=(0,o.x)(),N=I.isChatOpen,w=I.toggleChatOpen,P=(0,l.useCallback)((function(){w(),(0,o.e)("cb_chat_collapse_icon",null===b||void 0===b?void 0:b.uuid,{status:N?"open":"close"})}),[N,null===b||void 0===b?void 0:b.uuid,w]);(0,i.FI)((function(){null===T||void 0===T||T(Boolean(b&&!h))}));var D,M=(0,l.useMemo)((function(){return K(K({},o.E),{},{conversationUuid:null===b||void 0===b?void 0:b.uuid})}),[null===b||void 0===b?void 0:b.uuid]);return E?L&&!N?(0,m.jsx)(o.F,{}):null!==b&&void 0!==b&&b.uuid&&N?(0,m.jsx)(r.SV,{name:"logged-in",fallback:(0,m.jsx)(o.G,{conversationUuid:b.uuid}),defaultMetadata:M,children:(0,m.jsx)(o.H,{conversationUuid:b.uuid,onCollapse:P,children:(0,m.jsx)(l.Suspense,{fallback:(0,m.jsx)(o.I,{onCollapse:P,layout:x}),children:(0,m.jsx)(fe,{conversationNodeId:null===f||void 0===f||null===(D=f.viewer.conversations)||void 0===D?void 0:D.__id,onCreateConversation:C})})})}):null!==b&&void 0!==b&&b.uuid&&!N&&f.viewer.conversations?(0,m.jsx)(we,{queryData:f.viewer.conversations}):(0,m.jsx)(De,{userName:null!==(s=null===f||void 0===f||null===(u=f.viewer)||void 0===u||null===(d=u.userProperties)||void 0===d||null===(c=d.personalDetails)||void 0===c||null===(g=c.legalName)||void 0===g?void 0:g.firstName)&&void 0!==s?s:void 0,conversationNodeId:null===f||void 0===f||null===(v=f.viewer.conversations)||void 0===v?void 0:v.__id,onCreateConversation:C}):null}function Be(){var e=U((0,l.useState)(!1),2),n=e[0],a=e[1],i=(0,l.useCallback)((function(e){e&&a(!0)}),[]);return n?(0,m.jsx)(o.A,{isInitiallyOpen:!0,children:(0,m.jsx)(Ae,{})}):(0,m.jsx)(Ee,{loadingFallback:(0,m.jsx)(o.D,{}),skipFallback:(0,m.jsx)(Ae,{}),errorFallback:(0,m.jsx)(_e,{onCreateConversation:i}),successFallback:(0,m.jsx)(o.A,{isInitiallyOpen:!0,children:(0,m.jsx)(Ae,{})})})}}}]);
//# sourceMappingURL=3a179640.66089e1dcafd7f26.js.map